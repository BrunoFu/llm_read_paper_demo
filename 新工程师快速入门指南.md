# 新工程师快速入门指南

## 🚀 5分钟快速体验

### 1. 环境准备
```bash
# 克隆项目（如果需要）
cd /Users/fro/Library/CloudStorage/OneDrive-个人/code/OCR_api_test

# 安装依赖
pip install -r requirements.txt

# 检查依赖
python check_fsz_dependencies.py
```

### 2. 🎯 **最佳体验：使用封装的流水线**
```python
# 创建测试文件 test_pipeline.py
import asyncio
from tools.paper_processing_service import process_paper_pipeline

async def main():
    result = await process_paper_pipeline("example_pdfs/sample.pdf")

    if result.success:
        print(f"✅ 处理成功！")
        print(f"📄 最终报告: {result.final_report_path}")
        print(f"⏱️ 处理耗时: {result.total_processing_time:.2f}秒")
    else:
        print(f"❌ 处理失败: {result.pipeline_error}")

asyncio.run(main())
```

```bash
# 运行测试
python test_pipeline.py
```

### 3. 查看详细示例
```bash
# 运行官方示例（包含多种使用场景）
python tools/example_usage.py
```

### 4. Web界面体验
```bash
cd frontend
python app.py
# 打开浏览器访问 http://localhost:7860
```

### 5. 传统方式（不推荐新手）
```bash
# 使用main.py进行基础测试（主要用于数据库管理）
python main.py example_pdfs/sample.pdf --basic

# 查看结果
ls output/sample/
```

## 📁 核心文件快速定位

### 🎯 **最重要：项目核心封装**
- **🌟 核心入口**：`tools/paper_processing_service.py` - 完整四阶段流水线封装
- **📋 数据模型**：`tools/pipeline_models.py` - PipelineConfig、PipelineResult等
- **📖 使用示例**：`tools/example_usage.py` - 详细的使用示例和最佳实践
- **🧪 测试脚本**：`tools/test_pipeline_service.py` - 完整测试

### 想了解整体流程？
- **批量处理**：`run_fsz_batch_processing.py` - 批量处理入口
- **Web界面**：`frontend/app.py` - 用户界面
- **数据库管理**：`main.py` - 简化版单文件处理（主要用于数据库操作）

### 想了解各个阶段？
1. **阶段1**：`crop_pdf_first_three_page/ocr_processor_mineru.py`
2. **阶段2**：`pdf_content_extractor/pdf_ocr.py`
3. **阶段3**：`section_data_extractor/extract_sections.py`
4. **阶段4**：`report_generator/report_processor.py`

### 想了解数据结构？
- **流水线模型**：`tools/pipeline_models.py` - 现代化的数据结构
- **数据库模型**：`database/models.py` - 传统数据库模型
- **数据库操作**：`database/db_manager.py`
- **配置管理**：`config.py` 和 `utils/llm_config.py`

## 🔧 常见修改场景

### 🎯 **推荐：基于封装服务进行定制**
**修改位置**：`tools/paper_processing_service.py` 或创建自定义服务
```python
from tools.paper_processing_service import PaperProcessingService
from tools.pipeline_models import PipelineConfig

# 场景1：自定义配置
config = PipelineConfig(
    output_dir="my_output",
    api_name="custom_api",
    llm_config={"temperature": 0.1},
    max_retry_attempts=5
)

# 场景2：自定义进度监控
def my_progress_callback(progress_info):
    # 你的进度处理逻辑
    print(f"进度: {progress_info.overall_progress:.1%}")

# 场景3：自定义错误处理
def my_error_callback(stage, error):
    # 你的错误处理逻辑
    print(f"阶段 {stage.value} 出错: {error}")

# 使用自定义配置
result = await process_paper_pipeline(
    pdf_path="your_paper.pdf",
    config=config,
    progress_callback=my_progress_callback,
    error_callback=my_error_callback
)
```

### 传统修改方式

### 场景1：添加新的OCR服务
**修改位置**：`pdf_content_extractor/`
```python
# 在 pdf_ocr.py 中添加新的OCR实现
class NewOCRService:
    def process_pdf(self, pdf_path):
        # 你的OCR逻辑
        pass
```

### 场景2：修改元数据提取逻辑
**修改位置**：`tools/enhanced_metadata_extractor.py`
```python
# 修改元数据提取函数
def extract_metadata_from_pdf(pdf_path, first_pages_path, template_path):
    # 你的提取逻辑
    pass
```

### 场景3：自定义报告格式
**修改位置**：`report_generator/`
```python
# 添加新的报告生成器
class CustomReportGenerator:
    def generate_report(self, data):
        # 你的报告生成逻辑
        pass
```

### 场景4：修改Web界面
**修改位置**：`frontend/app.py`
```python
# 修改Gradio界面
def create_interface():
    # 你的界面定制
    pass
```

## 🐛 常见问题解决

### 问题1：API密钥配置
```python
# 在 utils/llm_config.py 中配置
LLM_CONFIG = {
    "openai": {
        "api_key": "your-openai-key"
    },
    "mistral": {
        "api_key": "your-mistral-key"
    }
}
```

### 问题2：依赖安装失败
```bash
# 使用虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

pip install -r requirements.txt
```

### 问题3：处理失败
```bash
# 查看日志
tail -f logs/ocr_api.log
tail -f logs/batch_process_fsz.log
```

## 📊 测试数据位置

### 示例PDF文件
- `example_pdfs/` - 测试用的PDF文件
- `fsz_ra_papers/` - 罗斯福新政相关文献
- `original_database/` - 原始数据库文件

### 输出结果
- `output/` - 单文件处理结果
- `results/` - 批量处理结果
- `logs/` - 系统日志

## 🎯 学习路径建议

### 第1天：理解整体架构
1. 阅读 `README.md` 和 `tools/README_pipeline_encapsulation.md`
2. 🎯 **重点**：运行 `python tools/example_usage.py` 查看完整示例
3. 查看输出结果结构

### 第2天：深入核心模块
1. 🎯 **重点**：研究 `tools/paper_processing_service.py` 的封装逻辑
2. 了解 `tools/pipeline_models.py` 的数据结构
3. 了解四个阶段的具体实现
4. 查看数据库结构（可选）

### 第3天：实践修改
1. 🎯 **推荐**：基于封装服务进行自定义配置
2. 尝试修改进度回调或错误处理
3. 运行测试验证修改
4. 查看日志排查问题

### 第4天：扩展开发
1. 添加自定义功能到流水线
2. 集成新的API服务
3. 优化处理性能
4. 创建自己的批量处理脚本

## 🔍 调试技巧

### 1. 启用详细日志
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 2. 单步调试
```python
# 在关键位置添加断点
import pdb; pdb.set_trace()
```

### 3. 查看中间结果
```python
# 保存中间处理结果
with open("debug_output.json", "w") as f:
    json.dump(intermediate_data, f, indent=2)
```

## 📞 获取帮助

### 查看文档
- `README.md` - 项目总体说明
- `项目功能分析报告.md` - 详细技术文档
- 各模块的 `README_*.md` - 模块说明

### 查看示例
- `tools/example_usage.py` - 使用示例
- `tools/demo_pipeline.py` - 流水线演示
- `frontend/test_*.py` - 测试示例

### 检查配置
- `config.py` - 基础配置
- `utils/llm_config.py` - LLM配置
- `requirements.txt` - 依赖列表

---

**作为 Claude 4.0 Opus**，我建议新工程师按照这个指南循序渐进地学习，先理解整体架构，再深入具体模块，最后进行实践开发。遇到问题时，优先查看日志和文档，必要时可以添加调试代码来理解程序执行流程。
